
# Shibari School Admin 1.2 LIfe

**Version:** 1.2 LIfe
**Date:** Current
**Description:** Одностраничное (SPA) React-приложение для обучающей платформы Shibari с интегрированной админ-панелью, интернет-магазином, каталогом видео и интерактивными модулями.

---

## 1. Список модулей и Функции

### Core (Ядро)
*   **App.tsx**: Главный контроллер. Управляет состоянием (уроки, модалки, корзина, пользователь), роутингом (через state) и связью с Supabase. Реализует логику блокировки уроков (первые 4 бесплатно) и синхронизацию профиля пользователя.
*   **AuthOverlay**: Модуль авторизации/регистрации.
*   **SettingsModal**: Админ-панель. Доступна только роли `admin`. Позволяет редактировать контент всех модулей (CRUD).

### Content Modules (Контент)
*   **Lesson Viewer (Sidebar + Main)**: Просмотр уроков с видео и текстом. Интеграция глоссария в текст.
*   **Marketplace (Shop)**: Интернет-магазин товаров. Поддержка динамических категорий (ввод текстовых тегов). Корзина, фильтрация, отправка заказов на email.
*   **Courses**: Продажа отдельных видеокурсов (лендинги внутри модалок).
*   **Catalog**: Библиотека видео с продвинутым тегированием (Категории и Подкатегории с множественным выбором).
*   **History**: Интерактивный таймлайн истории Шибари.
*   **Kinbakushi**: Интерактивный граф влияния мастеров (Genealogy).
*   **Events (Афиша)**: Список мероприятий с возможностью регистрации.
*   **Articles**: Рубрикатор статей и читалка (Reader).
*   **Dictionary**: Глоссарий терминов с поиском и подсветкой в тексте уроков. Управление через админ-панель.
*   **Navazu**: Информационный лендинг школы сертификации.

### Utils
*   **BehaviorTracker**: Система аналитики поведения пользователя (скролл, клики, время, цели).
*   **VideoPlayer**: Обертка над YouTube API (Facade pattern для производительности).

---

## 2. Связи с Supabase (Database Schema)

| Модуль UI | Таблица Supabase | Описание |
| :--- | :--- | :--- |
| **Auth / User** | `user_shibari` | Профили пользователей, роли (`admin`/`user`), история заказов, CRM данные. Синхронизируется с `auth.users`. |
| **Lessons** | `lessons_shibari` | Уроки: заголовок, видео, контент (массив параграфов), связи со статьями (4 слота). |
| **Shop** | `market_shibari` | Товары: цена, фото, описание, FAQ, поле `category` (string) для динамических фильтров. |
| **Courses** | `kurs_market_shibari` | Платные курсы: модули, цена, промо-видео. |
| **Events** | `event_shibari` | Афиша: дата, время, локация, цена. |
| **History** | `history_shibari` | События таймлайна. |
| **Articles** | `letter_shibari` | Статьи: JSON-контент (блочный конструктор). |
| **Catalog** | `catalog_videos_shibari` | Видео каталога с массивом `category_refs` (связь с подкатегориями). |
| **Catalog Cats**| `catalog_categories_shibari` | Дерево категорий и подкатегорий. |
| **Dictionary** | `dictionary_shibari` | Термины и определения. |
| **Analytics** | `user_behavior_logs_shibari` | Логи сессий и поведения. |
| **Settings** | `app_settings` | Глобальные настройки (EmailJS ключи и т.д.). |

---

## 3. Верстка и UI Layouts

### Главное окно (App Layout)
*   **Sidebar (Left)**:
    *   **Header**: Логотип, название школы.
    *   **List**: Список уроков. Логика: Уроки с индексом >= 4 заблокированы замком для неавторизованных. Активный урок подсвечен красным.
    *   **Footer**: Профиль пользователя (аватар, имя, роль), кнопка Настроек (для админа), Выход/Вход, Переключатель языка.
*   **Main Content (Right)**:
    *   **Top Nav**: Горизонтальное меню модулей (Статьи, Словарь, Магазин и т.д.). Стиль: uppercase, tracking-widest.
    *   **Hero Video**: Видеоплеер текущего урока (aspect-video).
    *   **Related Articles**: Сетка из 4 прямоугольных карточек ("Статья #1", "Статья #2"...). Ведут на Reader.
    *   **Text Content**: Текст урока с интерактивной подсветкой терминов.

### Верстка Модулей (Modals)
Все модули открываются как полноэкранные перекрытия (`fixed inset-0`) с анимацией появления.

*   **Marketplace**:
    *   Header: Поиск, Фильтры динамических категорий, Кнопка корзины.
    *   Grid: Карточки товаров (фото 3:4, название, цена).
    *   Detail Overlay: Поп-ап товара с галереей и полным описанием.
*   **Catalog**:
    *   Filter Bar: Теги категорий с выпадающими списками подкатегорий (Dropdowns).
    *   Grid: Видео-превью (aspect-video).
*   **History**:
    *   Layout: Вертикальная линия с точками (Timeline). Слева даты, справа контент.
*   **Kinbakushi**:
    *   Canvas: Горизонтальный скролл. Колонки по эпохам. Карточки мастеров соединены SVG-линиями (Безье кривые).
*   **Settings (Admin)**:
    *   Layout: Левый сайдбар с табами (Уроки, Магазин, и т.д.). Правая область — формы редактирования (Inputs, Textareas, JSON editors).

---

## 4. Версия
**Shibari School Admin 1.2 LIfe**
